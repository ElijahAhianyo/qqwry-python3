# Qqwry Cz88update

[_Documentation generated by Documatic_](https://www.documatic.com)

<!---Documatic-section-Codebase Structure-start--->
## Codebase Structure

<!---Documatic-block-system_architecture-start--->
```mermaid
None
```
<!---Documatic-block-system_architecture-end--->

# #
<!---Documatic-section-Codebase Structure-end--->

<!---Documatic-section-qqwry.cz88update.updateQQwry-start--->
## [qqwry.cz88update.updateQQwry](4-qqwry_cz88update.md#qqwry.cz88update.updateQQwry)

<!---Documatic-section-updateQQwry-start--->
<!---Documatic-block-qqwry.cz88update.updateQQwry-start--->
<details>
	<summary><code>qqwry.cz88update.updateQQwry</code> code snippet</summary>

```python
def updateQQwry(filename: Union[str, None]) -> Union[int, bytes]:

    def get_fetcher():
        proxy = urllib.request.ProxyHandler({})
        opener = urllib.request.build_opener(proxy)

        def open_url(file_name, url):
            headers = {'User-Agent': 'Mozilla/3.0 (compatible; Indy Library)', 'Host': 'update.cz88.net'}
            req = urllib.request.Request(url, headers=headers)
            try:
                r = opener.open(req, timeout=60)
                dat = r.read()
                if not dat:
                    raise Exception('文件大小为零')
                return dat
            except Exception as e:
                logger.error('下载%s时出错: %s' % (file_name, str(e)))
                return None
        return open_url
    fetcher = get_fetcher()
    url = 'http://update.cz88.net/ip/copywrite.rar'
    data = fetcher('copywrite.rar', url)
    if not data:
        return -1
    if len(data) <= 24 or data[:4] != b'CZIP':
        logger.error('解析copywrite.rar时出错')
        return -2
    (version, unknown1, size, unknown2, key) = struct.unpack_from('<IIIII', data, 4)
    if unknown1 != 1:
        logger.error('解析copywrite.rar时出错')
        return -2
    url = 'http://update.cz88.net/ip/qqwry.rar'
    data = fetcher('qqwry.rar', url)
    if not data:
        return -3
    if size != len(data):
        logger.error('qqwry.rar文件大小不符合copywrite.rar的数据')
        return -4
    head = bytearray(512)
    for i in range(512):
        key = key * 2053 + 1 & 255
        head[i] = data[i] ^ key
    data = head + data[512:]
    try:
        data = zlib.decompress(data)
    except:
        logger.error('解压缩qqwry.rar时出错')
        return -5
    if filename == None:
        return data
    elif type(filename) == str:
        try:
            with open(filename, 'wb') as f:
                f.write(data)
            return len(data)
        except:
            logger.error('保存到最终文件时出错')
            return -6
    else:
        logger.error('保存到最终文件时出错')
        return -6
```
</details>
<!---Documatic-block-qqwry.cz88update.updateQQwry-end--->
<!---Documatic-section-updateQQwry-end--->

# #
<!---Documatic-section-qqwry.cz88update.updateQQwry-end--->

[_Documentation generated by Documatic_](https://www.documatic.com)